!function(e,t,n){function l(e,t){var n=Math.max(0,e[0]-t[0],t[0]-e[1]),r=Math.max(0,e[2]-t[1],t[1]-e[3]);return n+r}function c(t,n,r,i){var s=t.length,o=i?"offset":"position";r=r||0;while(s--){var u=t[s].el?t[s].el:e(t[s]),a=u[o]();a.left+=parseInt(u.css("margin-left"),10);a.top+=parseInt(u.css("margin-top"),10);n[s]=[a.left-r,a.left+u.outerWidth()+r,a.top-r,a.top+u.outerHeight()+r]}}function h(e,t){var n=t.offset();return{left:e.left-n.left,top:e.top-n.top}}function p(e,t,n){t=[t.left,t.top];n=n&&[n.left,n.top];var r,i=e.length,s=[];while(i--){r=e[i];s[i]=[i,l(r,t),n&&l(r,n)]}s=s.sort(function(e,t){return t[1]-e[1]||t[2]-e[2]||t[0]-e[0]});return s}function d(t){this.options=e.extend({},o,t);this.containers=[];if(!this.options.parentContainer){this.scrollProxy=e.proxy(this.scroll,this);this.dragProxy=e.proxy(this.drag,this);this.dropProxy=e.proxy(this.drop,this);this.placeholder=e(this.options.placeholder);if(!t.isValidTarget)this.options.isValidTarget=n}}function v(t,n){this.el=t;this.options=e.extend({},s,n);this.group=d.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.parentContainer=this.options.parentContainer;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var i=this.rootGroup.options.itemPath,o=i?this.el.find(i):this.el;o.on(r.start,this.handle,e.proxy(this.dragInit,this));if(this.options.drop)this.group.containers.push(this)}var r,i="sortable2",s={drag:true,drop:true,exclude:"",nested:true,vertical:true},o={afterMove:function(e,t,n){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",isValidTarget:function(e,t){return true},onCancel:function(e,t,n,r){},onDrag:function(e,t,n,r){e.css(t)},onDragStart:function(t,n,r,i){t.css({height:t.height(),width:t.width()});t.addClass("dragged");e("body").addClass("dragging")},onDrop:function(t,n,r,i){t.removeClass("dragged").removeAttr("style");e("body").removeClass("dragging")},onMousedown:function(e,t,n){if(n.target.nodeName!="INPUT"){n.preventDefault();return true}},placeholder:'<li class="placeholder"/>',pullPlaceholder:true,serialize:function(t,n,r){var i=e.extend({},t.data());if(r)return n;else if(n[0]){i.children=n;delete i.subContainer}delete i.sortable;return i},tolerance:0},u={},a=0,f={left:0,top:0,bottom:0,right:0};r={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"};d.get=function(e){if(!u[e.group]){if(e.group===n)e.group=a++;u[e.group]=new d(e)}return u[e.group]};d.prototype={dragInit:function(t,n){this.$document=e(n.el[0].ownerDocument);if(n.enabled()){this.item=e(t.target).closest(this.options.itemSelector);this.itemContainer=n;if(this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,o.onMousedown,t)){return}this.setPointer(t);this.toggleListeners("on")}else{this.toggleListeners("on",["drop"])}this.setupDelayTimer();this.dragInitDone=true},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,o.onDragStart,e);this.item.before(this.placeholder);this.dragging=true}this.setPointer(e);this.options.onDrag(this.item,h(this.pointer,this.item.offsetParent()),o.onDrag,e);var t=e.pageX,n=e.pageY,r=this.sameResultBox,i=this.options.tolerance;if(!r||r.top-i>n||r.bottom+i<n||r.left-i>t||r.right+i<t)if(!this.searchValidTarget())this.placeholder.detach()},drop:function(e){this.toggleListeners("off");this.dragInitDone=false;if(this.dragging){if(this.placeholder.closest("html")[0])this.placeholder.before(this.item).detach();else this.options.onCancel(this.item,this.itemContainer,o.onCancel,e);this.options.onDrop(this.item,this.getContainer(this.item),o.onDrop,e);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=n;this.dragging=false}},searchValidTarget:function(e,t){if(!e){e=this.relativePointer||this.pointer;t=this.lastRelativePointer||this.lastPointer}var r=p(this.getContainerDimensions(),e,t),i=r.length;while(i--){var s=r[i][0],o=r[i][1];if(!o||this.options.pullPlaceholder){var u=this.containers[s];if(!u.disabled){if(!this.$getOffsetParent()){var a=u.getItemOffsetParent();e=h(e,a);t=h(t,a)}if(u.searchValidTarget(e,t))return true}}}if(this.sameResultBox)this.sameResultBox=n},movePlaceholder:function(e,t,n,r){var i=this.lastAppendedItem;if(!r&&i&&i[0]===t[0])return;t[n](this.placeholder);this.lastAppendedItem=t;this.sameResultBox=r;this.options.afterMove(this.placeholder,e,t)},getContainerDimensions:function(){if(!this.containerDimensions)c(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent());return this.containerDimensions},getContainer:function(e){return e.closest(this.options.containerSelector).data(i)},$getOffsetParent:function(){if(this.offsetParent===n){var e=this.containers.length-1,t=this.containers[e].getItemOffsetParent();if(!this.options.parentContainer){while(e--){if(t[0]!=this.containers[e].getItemOffsetParent()[0]){t=false;break}}}this.offsetParent=t}return this.offsetParent},setPointer:function(e){var t={left:e.pageX,top:e.pageY};if(this.$getOffsetParent()){var n=h(t,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=n}this.lastPointer=this.pointer;this.pointer=t},distanceMet:function(e){return Math.max(Math.abs(this.pointer.left-e.pageX),Math.abs(this.pointer.top-e.pageY))>=this.options.distance},setupDelayTimer:function(){var e=this;this.delayMet=!this.options.delay;if(!this.delayMet){clearTimeout(this._mouseDelayTimer);this._mouseDelayTimer=setTimeout(function(){e.delayMet=true},this.options.delay)}},scroll:function(e){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(t,n){var i=this;n=n||["drag","drop","scroll"];e.each(n,function(e,n){i.$document[t](r[n],i[n+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=n},clearDimensions:function(){this.containerDimensions=n;var e=this.containers.length;while(e--){this.containers[e].clearDimensions()}},destroy:function(){u[this.options.group]=n}};v.prototype={dragInit:function(e){var t=this.rootGroup;if(!t.dragInitDone&&e.which===1&&this.options.drag){t.dragInit(e,this)}},searchValidTarget:function(e,t){var n=p(this.getItemDimensions(),e,t),r=n.length,i=this.rootGroup,s=!i.options.isValidTarget||i.options.isValidTarget(i.item,this);if(!r&&s){var o=this.rootGroup.options.itemPath,u=o?this.el.find(o):this.el;i.movePlaceholder(this,u,"append");return true}else while(r--){var a=n[r][0],f=n[r][1];if(!f&&this.hasChildGroup(a)){var l=this.getContainerGroup(a).searchValidTarget(e,t);if(l)return true}else if(s){this.movePlaceholder(a,e);return true}}},movePlaceholder:function(t,n){var r=e(this.items[t]),i=this.itemDimensions[t],s="after",o=r.outerWidth(),u=r.outerHeight(),a=r.offset(),l={left:a.left,right:a.left+o,top:a.top,bottom:a.top+u};if(this.options.vertical){var c=(i[2]+i[3])/2,h=n.top<=c;if(h){s="before";l.bottom-=u/2}else l.top+=u/2}else{var p=(i[0]+i[1])/2,d=n.left<=p;if(d){s="before";l.right-=o/2}else l.left+=o/2}if(this.hasChildGroup(t))l=f;this.rootGroup.movePlaceholder(this,r,s,l)},getItemDimensions:function(){if(!this.itemDimensions){this.items=this.$getChildren(this.el,"item").filter(":not(.placeholder, .dragged)").get();c(this.items,this.itemDimensions=[],this.options.tolerance)}return this.itemDimensions},getItemOffsetParent:function(){var e,t=this.el;if(t.css("position")==="relative"||t.css("position")==="absolute"||t.css("position")==="fixed")e=t;else e=t.offsetParent();return e},hasChildGroup:function(e){return this.options.nested&&this.getContainerGroup(e)},getContainerGroup:function(t){var r=e.data(this.items[t],"subContainer");if(r===n){var s=this.$getChildren(this.items[t],"container");r=false;if(s[0]){var o=e.extend({},this.options,{parentContainer:this,rootGroup:this.rootGroup,group:a++});r=s[i](o).data(i).group}e.data(this.items[t],"subContainer",r)}return r},enabled:function(){return!this.disabled&&(!this.parentContainer||this.parentContainer.enabled())},$getChildren:function(t,n){var r=this.rootGroup.options,i=r[n+"Path"],s=r[n+"Selector"];t=e(t);if(i)t=t.find(i);return t.children(s)},_serialize:function(t,n){var r=this,i=n?"item":"container",s=this.$getChildren(t,i).not(this.options.exclude).map(function(){return r._serialize(e(this),!n)}).get();return this.rootGroup.options.serialize(t,s,n)},clearDimensions:function(){this.itemDimensions=n;if(this.items&&this.items[0]){var t=this.items.length;while(t--){var r=e.data(this.items[t],"subContainer");if(r)r.clearDimensions()}}}};var m={enable:function(e){this.disabled=false},disable:function(e){this.disabled=true},serialize:function(){return this._serialize(this.el,true)},destroy:function(){this.rootGroup.destroy()}};e.extend(v.prototype,m);e.fn[i]=function(t){var r=Array.prototype.slice.call(arguments,1);return this.map(function(){var s=e(this),o=s.data(i);if(o&&m[t])return m[t].apply(o,r)||this;else if(!o&&(t===n||typeof t==="object"))s.data(i,new v(s,t));return this})}}(jQuery,window)