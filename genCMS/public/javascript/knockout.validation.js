(function(e){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){e(require("knockout"),exports)}else if(typeof define==="function"&&define["amd"]){define(["knockout","exports"],e)}else{e(ko,ko.validation={})}})(function(e,t){function l(e){var t=e==="max";return function(r,i){if(n.utils.isEmptyVal(r)){return true}var s,o;if(i.typeAttr===undefined){o="text";s=i}else{o=i.typeAttr;s=i.value}if(!isNaN(s)){o="number"}var u,a,f;switch(o.toLowerCase()){case"week":u=/^(\d{4})-W(\d{2})$/;a=r.match(u);if(a===null){throw"Invalid value for "+e+" attribute for week input.  Should look like "+"'2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min"}f=s.match(u);if(!f){return false}if(t){return a[1]<f[1]||a[1]===f[1]&&a[2]<=f[2]}else{return a[1]>f[1]||a[1]===f[1]&&a[2]>=f[2]}break;case"month":u=/^(\d{4})-(\d{2})$/;a=r.match(u);if(a===null){throw"Invalid value for "+e+" attribute for month input.  Should look like "+"'2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min"}f=s.match(u);if(!f){return false}if(t){return a[1]<f[1]||a[1]===f[1]&&a[2]<=f[2]}else{return a[1]>f[1]||a[1]===f[1]&&a[2]>=f[2]}break;case"number":case"range":if(t){return!isNaN(r)&&parseFloat(r)<=parseFloat(s)}else{return!isNaN(r)&&parseFloat(r)>=parseFloat(s)}break;default:if(t){return r<=s}else{return r>=s}}}}function c(e,t,r){if(!t.validator(e(),r.params===undefined?true:i(r.params))){e.setError(n.formatMessage(r.message||t.message,i(r.params),e));return false}else{return true}}function h(e,t,r){e.isValidating(true);var s=function(s){var o=false,u="";if(!e.__valid__()){e.isValidating(false);return}if(s["message"]){o=s.isValid;u=s.message}else{o=s}if(!o){e.error(n.formatMessage(u||r.message||t.message,i(r.params),e));e.__valid__(o)}e.isValidating(false)};t.validator(e(),i(r.params||true),s)}if(typeof e===undefined){throw"Knockout is required, please ensure it is loaded before loading this validation plug-in"}e.validation=t;var n=e.validation,r=e.utils,i=r.unwrapObservable,s=r.arrayForEach,o=r.extend;var u={registerExtenders:true,messagesOnModified:true,errorsAsTitle:true,errorsAsTitleOnModified:false,messageTemplate:null,insertMessages:true,parseInputAttributes:false,writeInputAttributes:false,decorateInputElement:false,decorateElementOnModified:true,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:false,grouping:{deep:false,observable:true,live:false},validate:{}};var a=o({},u);a.html5Attributes=["required","pattern","min","max","step"];a.html5InputTypes=["email","number","date"];a.reset=function(){o(a,u)};n.configuration=a;n.utils=function(){var e=(new Date).getTime();var t={};var r="__ko_validation__";return{isArray:function(e){return e.isArray||Object.prototype.toString.call(e)==="[object Array]"},isObject:function(e){return e!==null&&typeof e==="object"},isObservableArray:function(e){return!!e&&typeof e["remove"]==="function"&&typeof e["removeAll"]==="function"&&typeof e["destroy"]==="function"&&typeof e["destroyAll"]==="function"&&typeof e["indexOf"]==="function"&&typeof e["replace"]==="function"},values:function(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t},getValue:function(e){return typeof e==="function"?e():e},hasAttribute:function(e,t){return e.getAttribute(t)!==null},getAttribute:function(e,t){return e.getAttribute(t)},setAttribute:function(e,t,n){return e.setAttribute(t,n)},isValidatable:function(e){return!!(e&&e.rules&&e.isValid&&e.isModified)},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},newId:function(){return e+=1},getConfigOptions:function(e){var t=n.utils.contextFor(e);return t||n.configuration},setDomData:function(e,i){var s=e[r];if(!s){e[r]=s=n.utils.newId()}t[s]=i},getDomData:function(e){var n=e[r];if(!n){return undefined}return t[n]},contextFor:function(e){switch(e.nodeType){case 1:case 8:var t=n.utils.getDomData(e);if(t){return t}if(e.parentNode){return n.utils.contextFor(e.parentNode)}break}return undefined},isEmptyVal:function(e){if(e===undefined){return true}if(e===null){return true}if(e===""){return true}},getOriginalElementTitle:function(e){var t=n.utils.getAttribute(e,"data-orig-title"),r=e.title,i=n.utils.hasAttribute(e,"data-orig-title");return i?t:r},async:function(e){if(window.setImmediate){window.setImmediate(e)}else{window.setTimeout(e,0)}},forEach:function(e,t){if(n.utils.isArray(e)){return s(e,t)}for(var r in e){if(e.hasOwnProperty(r)){t(e[r],r)}}}}}();var f=function(){function f(e){s(e.subscriptions,function(e){e.dispose()});e.subscriptions=[]}function l(e){if(e.options.deep){s(e.flagged,function(e){delete e.__kv_traversed});e.flagged.length=0}if(!e.options.live){f(e)}}function c(e,t){t.validatables=[];f(t);h(e,t);l(t)}function h(t,n,r){var i=[],s=t.peek?t.peek():t;if(t.__kv_traversed===true){return}if(n.options.deep){t.__kv_traversed=true;n.flagged.push(t)}r=r!==undefined?r:n.options.deep?1:-1;if(e.isObservable(t)){if(!t.isValid){t.extend({validatable:true})}n.validatables.push(t);if(n.options.live&&a.isObservableArray(t)){n.subscriptions.push(t.subscribe(function(){n.graphMonitor.valueHasMutated()}))}}if(s&&!s._destroy){if(a.isArray(s)){i=s}else if(a.isObject(s)){i=a.values(s)}}if(r!==0){a.forEach(i,function(e){if(e&&!e.nodeType){h(e,n,r+1)}})}}function p(e){var t=[];s(e,function(e){if(!e.isValid()){t.push(e.error())}});return t}var t=0,u=n.configuration,a=n.utils;return{init:function(e,r){if(t>0&&!r){return}e=e||{};e.errorElementClass=e.errorElementClass||e.errorClass||u.errorElementClass;e.errorMessageClass=e.errorMessageClass||e.errorClass||u.errorMessageClass;o(u,e);if(u.registerExtenders){n.registerExtenders()}t=1},configure:function(e){n.init(e)},reset:n.configuration.reset,group:function(n,i){i=o(o({},u.grouping),i);var a={options:i,graphMonitor:e.observable(),flagged:[],subscriptions:[],validatables:[]};var f=null;if(i.observable){c(n,a);f=e.computed(function(){a.graphMonitor();c(n,a);return p(a.validatables)})}else{f=function(){c(n,a);return p(a.validatables)}}f.showAllMessages=function(e){if(e===undefined){e=true}f();s(a.validatables,function(t){t.isModified(e)})};n.errors=f;n.isValid=function(){return n.errors().length===0};n.isAnyMessageShown=function(){var e=false;f();e=!!r.arrayFirst(a.validatables,function(e){return!e.isValid()&&e.isModified()});return e};return f},formatMessage:function(e,t,n){if(typeof e==="function"){return e(t,n)}return e.replace(/\{0\}/gi,i(t))},addRule:function(e,t){e.extend({validatable:true});e.rules.push(t);return e},addAnonymousRule:function(e,t){if(t["message"]===undefined){t["message"]="Error"}if(t.onlyIf){t.condition=t.onlyIf}n.addRule(e,t)},addExtender:function(t){e.extenders[t]=function(e,r){if(r&&(r.message||r.onlyIf)){return n.addRule(e,{rule:t,message:r.message,params:a.isEmptyVal(r.params)?true:r.params,condition:r.onlyIf})}else{return n.addRule(e,{rule:t,params:r})}}},registerExtenders:function(){if(u.registerExtenders){for(var t in n.rules){if(n.rules.hasOwnProperty(t)){if(!e.extenders[t]){n.addExtender(t)}}}}},insertValidationMessage:function(e){var t=document.createElement("SPAN");t.className=a.getConfigOptions(e).errorMessageClass;a.insertAfter(e,t);return t},parseInputValidationAttributes:function(e,t){s(n.configuration.html5Attributes,function(r){if(a.hasAttribute(e,r)){var i=e.getAttribute(r)||true;if(r==="min"||r==="max"){var s=e.getAttribute("type");if(typeof s==="undefined"||!s){s="text"}i={typeAttr:s,value:i}}n.addRule(t(),{rule:r,params:i})}});var r=e.getAttribute("type");s(n.configuration.html5InputTypes,function(e){if(e===r){n.addRule(t(),{rule:e==="date"?"dateISO":e,params:true})}})},writeInputValidationAttributes:function(e,t){var i=t();if(!i||!i.rules){return}var o=i.rules();s(n.configuration.html5Attributes,function(t){var n;var i=r.arrayFirst(o,function(e){return e.rule.toLowerCase()===t.toLowerCase()});if(!i){return}n=i.params;if(i.rule==="pattern"){if(i.params instanceof RegExp){n=i.params.source}}e.setAttribute(t,n)});o=null},makeBindingHandlerValidatable:function(t){var n=e.bindingHandlers[t].init;e.bindingHandlers[t].init=function(t,r,i,s,o){n(t,r,i,s,o);return e.bindingHandlers["validationCore"].init(t,r,i,s,o)}},setRules:function(t,r){var s=function(t,r){if(!t||!r){return}for(var o in r){if(!r.hasOwnProperty(o)){continue}var u=r[o];if(!t[o]){continue}var f=t[o],l=i(f),c={},h={};for(var p in u){if(!u.hasOwnProperty(p)){continue}if(n.rules[p]){c[p]=u[p]}else{h[p]=u[p]}}if(e.isObservable(f)){f.extend(c)}if(l&&a.isArray(l)){for(var d=0;d<l.length;d++){s(l[d],h)}}else{s(l,h)}}};s(t,r)}}}();o(e.validation,f);n.rules={};n.rules["required"]={validator:function(e,t){var n=/^\s+|\s+$/g,r;if(e===undefined||e===null){return!t}r=e;if(typeof e==="string"){r=e.replace(n,"")}if(!t){return true}return(r+"").length>0},message:"This field is required."};n.rules["min"]={validator:l("min"),message:"Please enter a value greater than or equal to {0}."};n.rules["max"]={validator:l("max"),message:"Please enter a value less than or equal to {0}."};n.rules["minLength"]={validator:function(e,t){return n.utils.isEmptyVal(e)||e.length>=t},message:"Please enter at least {0} characters."};n.rules["maxLength"]={validator:function(e,t){return n.utils.isEmptyVal(e)||e.length<=t},message:"Please enter no more than {0} characters."};n.rules["pattern"]={validator:function(e,t){return n.utils.isEmptyVal(e)||e.toString().match(t)!==null},message:"Please check this value."};n.rules["step"]={validator:function(e,t){if(n.utils.isEmptyVal(e)||t==="any"){return true}var r=e*100%(t*100);return Math.abs(r)<1e-5||Math.abs(1-r)<1e-5},message:"The value must increment by {0}"};n.rules["email"]={validator:function(e,t){if(!t){return true}return n.utils.isEmptyVal(e)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},message:"Please enter a proper email address"};n.rules["date"]={validator:function(e,t){if(!t){return true}return n.utils.isEmptyVal(e)||t&&!/Invalid|NaN/.test(new Date(e))},message:"Please enter a proper date"};n.rules["dateISO"]={validator:function(e,t){if(!t){return true}return n.utils.isEmptyVal(e)||t&&/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(e)},message:"Please enter a proper date"};n.rules["number"]={validator:function(e,t){if(!t){return true}return n.utils.isEmptyVal(e)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},message:"Please enter a number"};n.rules["digit"]={validator:function(e,t){if(!t){return true}return n.utils.isEmptyVal(e)||t&&/^\d+$/.test(e)},message:"Please enter a digit"};n.rules["phoneUS"]={validator:function(e,t){if(!t){return true}if(n.utils.isEmptyVal(e)){return true}if(typeof e!=="string"){return false}e=e.replace(/\s+/g,"");return t&&e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},message:"Please specify a valid phone number"};n.rules["equal"]={validator:function(e,t){var r=t;return e===n.utils.getValue(r)},message:"Values must equal"};n.rules["notEqual"]={validator:function(e,t){var r=t;return e!==n.utils.getValue(r)},message:"Please choose another value."};n.rules["unique"]={validator:function(e,t){var i=n.utils.getValue(t.collection),s=n.utils.getValue(t.externalValue),o=0;if(!e||!i){return true}r.arrayFilter(i,function(n){if(e===(t.valueAccessor?t.valueAccessor(n):n)){o++}});return o<(!!s?1:2)},message:"Please make sure the value is unique."};(function(){n.registerExtenders()})();e.bindingHandlers["validationCore"]=function(){return{init:function(t,r,i,s,o){var u=n.utils.getConfigOptions(t);var a=r();if(u.parseInputAttributes){n.utils.async(function(){n.parseInputValidationAttributes(t,r)})}if(u.insertMessages&&n.utils.isValidatable(a)){var f=n.insertValidationMessage(t);if(u.messageTemplate){e.renderTemplate(u.messageTemplate,{field:a},null,f,"replaceNode")}else{e.applyBindingsToNode(f,{validationMessage:a})}}if(u.writeInputAttributes&&n.utils.isValidatable(a)){n.writeInputValidationAttributes(t,r)}if(u.decorateInputElement&&n.utils.isValidatable(a)){e.applyBindingsToNode(t,{validationElement:a})}}}}();n.makeBindingHandlerValidatable("value");n.makeBindingHandlerValidatable("checked");e.bindingHandlers["validationMessage"]={update:function(t,s){var o=s(),u=n.utils.getConfigOptions(t),a=i(o),f=null,l=false,c=false;if(!o.isValid||!o.isModified){throw new Error("Observable is not validatable")}l=o.isModified();c=o.isValid();var h=null;if(!u.messagesOnModified||l){h=c?null:o.error}var p=!u.messagesOnModified||l?!c:false;var d=t.style.display!=="none";if(u.allowHtmlMessages){r.setHtml(t,h)}else{e.bindingHandlers.text.update(t,function(){return h})}if(d&&!p){t.style.display="none"}else if(!d&&p){t.style.display=""}}};e.bindingHandlers["validationElement"]={update:function(t,r,s){var o=r(),u=n.utils.getConfigOptions(t),a=i(o),f=null,l=false,c=false;if(!o.isValid||!o.isModified){throw new Error("Observable is not validatable")}l=o.isModified();c=o.isValid();var h=function(){var e={};var t=!u.decorateElementOnModified||l?!c:false;e[u.errorElementClass]=t;return e};e.bindingHandlers.css.update(t,h,s);if(!u.errorsAsTitle){return}e.bindingHandlers.attr.update(t,function(){var e=!u.errorsAsTitleOnModified||l,r=n.utils.getOriginalElementTitle(t);if(e&&!c){return{title:o.error,"data-orig-title":r}}else if(!e||c){return{title:r,"data-orig-title":null}}})}};e.bindingHandlers["validationOptions"]=function(){return{init:function(e,t,r,s,u){var a=i(t());if(a){var f=o({},n.configuration);o(f,a);n.utils.setDomData(e,f)}}}}();e.extenders["validation"]=function(e,t){s(n.utils.isArray(t)?t:[t],function(t){n.addAnonymousRule(e,t)});return e};e.extenders["validatable"]=function(t,r){if(!n.utils.isObject(r)){r={enable:r}}if(!("enable"in r)){r.enable=true}if(r.enable&&!n.utils.isValidatable(t)){var i=n.configuration.validate||{};var s={throttleEvaluation:r.throttle||i.throttle};t.error=e.observable(null);t.rules=e.observableArray();t.isValidating=e.observable(false);t.__valid__=e.observable(true);t.isModified=e.observable(false);t.isValid=e.computed(t.__valid__);t.setError=function(e){t.error(e);t.__valid__(false)};t.clearError=function(){t.error(null);t.__valid__(true);return t};var u=t.subscribe(function(){t.isModified(true)});var a=e.computed(o({read:function(){var e=t(),r=t.rules();n.validateObservable(t);return true}},s));o(a,s);t._disposeValidation=function(){t.isValid.dispose();t.rules.removeAll();if(t.isModified.getSubscriptionsCount()>0){t.isModified._subscriptions["change"]=[]}if(t.isValidating.getSubscriptionsCount()>0){t.isValidating._subscriptions["change"]=[]}if(t.__valid__.getSubscriptionsCount()>0){t.__valid__._subscriptions["change"]=[]}u.dispose();a.dispose();delete t["rules"];delete t["error"];delete t["isValid"];delete t["isValidating"];delete t["__valid__"];delete t["isModified"]}}else if(r.enable===false&&t._disposeValidation){t._disposeValidation()}return t};n.validateObservable=function(e){var t=0,r,i,s=e.rules(),o=s.length;for(;t<o;t++){i=s[t];if(i.condition&&!i.condition()){continue}r=i.rule?n.rules[i.rule]:i;if(r["async"]||i["async"]){h(e,r,i)}else{if(!c(e,r,i)){return false}}}e.clearError();return true};n.localize=function(e){var t,r;for(r in e){if(n.rules.hasOwnProperty(r)){n.rules[r].message=e[r]}}};e.applyBindingsWithValidation=function(t,r,i){var s=arguments.length,o,u;if(s>2){o=r;u=i}else if(s<2){o=document.body}else{if(arguments[1].nodeType){o=r}else{u=arguments[1]}}n.init();if(u){n.utils.setDomData(o,u)}e.applyBindings(t,r)};var p=e.applyBindings;e.applyBindings=function(e,t){n.init();p(e,t)};e.validatedObservable=function(t){if(!n.utils.isObject(t)){return e.observable(t).extend({validatable:true})}var r=e.observable(t);r.isValid=e.observable();r.errors=n.group(t);r.errors.subscribe(function(e){r.isValid(e.length===0)});return r};})